<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>深入浅出：Vue 与 React 的虚拟 DOM 和 Diff 算法全解析（含 Vue 3 优化） | Ryan的个人网站</title><meta name="description" content="欢迎访问Ryan的个人网站，这里分享最新的软件开发技巧、编程项目和技术文章，帮助您提升开发技能。关注我们，获取实用的实战项目、开发教程及更多技术资源">
    <link rel="preload" href="/assets/style-CSlcUTs1.css" as="style"><link rel="stylesheet" href="/assets/style-CSlcUTs1.css">
    <link rel="modulepreload" href="/assets/app-_qvWuZqY.js"><link rel="modulepreload" href="/assets/xunidomhediffsuanfaxiangjie.html-Tjnt7s_g.js">
    <link rel="prefetch" href="/assets/timeline.html-BUPdRHUM.js" as="script"><link rel="prefetch" href="/assets/posts.html-DEa3dGz1.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-C9kT8HLo.js" as="script"><link rel="prefetch" href="/assets/1.html-CTC-mhaH.js" as="script"><link rel="prefetch" href="/assets/1.html-C_KnX8nw.js" as="script"><link rel="prefetch" href="/assets/1.html-DwpaD1_Q.js" as="script"><link rel="prefetch" href="/assets/1.html-RoFu0Vm7.js" as="script"><link rel="prefetch" href="/assets/1.html-Yuklavsk.js" as="script"><link rel="prefetch" href="/assets/1.html-BP0QGSao.js" as="script"><link rel="prefetch" href="/assets/1.html-CklZCwNz.js" as="script"><link rel="prefetch" href="/assets/1.html-DBbhssOb.js" as="script"><link rel="prefetch" href="/assets/1.html-BmOLT_F7.js" as="script"><link rel="prefetch" href="/assets/1.html-BY74pGnB.js" as="script"><link rel="prefetch" href="/assets/1.html-MxPdgydf.js" as="script"><link rel="prefetch" href="/assets/1.html-BdciQyu1.js" as="script"><link rel="prefetch" href="/assets/1.html-ClMjgVGJ.js" as="script"><link rel="prefetch" href="/assets/1.html-DOfvvg1j.js" as="script"><link rel="prefetch" href="/assets/1.html-CjfzmcA4.js" as="script"><link rel="prefetch" href="/assets/1.html-KL3MOKhF.js" as="script"><link rel="prefetch" href="/assets/1.html-B4ikgD-0.js" as="script"><link rel="prefetch" href="/assets/1.html-D-89SvsN.js" as="script"><link rel="prefetch" href="/assets/1.html-Dr0swzju.js" as="script"><link rel="prefetch" href="/assets/1.html-BhuAciGs.js" as="script"><link rel="prefetch" href="/assets/1.html-CNwvCeLu.js" as="script"><link rel="prefetch" href="/assets/1.html-Chor0jZE.js" as="script"><link rel="prefetch" href="/assets/1.html-ByWQFSUu.js" as="script"><link rel="prefetch" href="/assets/1.html-Bf0mSYb3.js" as="script"><link rel="prefetch" href="/assets/1.html-BbqlECQn.js" as="script"><link rel="prefetch" href="/assets/1.html-OX_sofsI.js" as="script"><link rel="prefetch" href="/assets/1.html-OGgGxEcG.js" as="script"><link rel="prefetch" href="/assets/1.html-BzbohLqh.js" as="script"><link rel="prefetch" href="/assets/1.html-1Wal-d1-.js" as="script"><link rel="prefetch" href="/assets/1.html-Cbmhnafm.js" as="script"><link rel="prefetch" href="/assets/1.html-BrUN-Rqk.js" as="script"><link rel="prefetch" href="/assets/1.html-Cmesf5so.js" as="script"><link rel="prefetch" href="/assets/1.html-BMC2z3_n.js" as="script"><link rel="prefetch" href="/assets/2.html-Bprrpk1I.js" as="script"><link rel="prefetch" href="/assets/3.html-DVqIktWL.js" as="script"><link rel="prefetch" href="/assets/index.html-CztyKiEM.js" as="script"><link rel="prefetch" href="/assets/AI Agent、MCPheFunction Callingyuanliqianxi.html-CZOYm4di.js" as="script"><link rel="prefetch" href="/assets/PromiseyuAsyncheAwaitshixianyuanlixiangjie.html-qnj9dO_Y.js" as="script"><link rel="prefetch" href="/assets/jsmokuaihuajizhidefazhan.html-CSUDU0Kc.js" as="script"><link rel="prefetch" href="/assets/keep-aliveyuanlijiexi.html-Bj8W4bRH.js" as="script"><link rel="prefetch" href="/assets/next.jsshangshouzhinan.html-adLSeuAy.js" as="script"><link rel="prefetch" href="/assets/reactjichuzhishizongjie.html-CAyH-Alu.js" as="script"><link rel="prefetch" href="/assets/three.jsrumenzhinan.html-VXik-YCF.js" as="script"><link rel="prefetch" href="/assets/shenrulijie CSS zhongde BFC he IFC：bujudehexinjizhi.html-C8s1XLRb.js" as="script"><link rel="prefetch" href="/assets/shenrulijiejsyibubiancheng，congyuanlidaoshijian.html--wZxmOoP.js" as="script"><link rel="prefetch" href="/assets/shenrulijiejsbibao.html-CqVJ_wxY.js" as="script"><link rel="prefetch" href="/assets/Dockerrumen.html-BBG6BTzl.js" as="script"><link rel="prefetch" href="/assets/Dockerquanzhanzhinan.html-BiGVktZw.js" as="script"><link rel="prefetch" href="/assets/k8srumen.html-DVYtEW1K.js" as="script"><link rel="prefetch" href="/assets/pythonjichuyufazongjie.html-BiMN1EmG.js" as="script"><link rel="prefetch" href="/assets/bendidajianpythonkaifahuanjing.html-C4Ab6J0B.js" as="script"><link rel="prefetch" href="/assets/webpackheviteyuanliqianxi.html-BmJDZzni.js" as="script"><link rel="prefetch" href="/assets/ruhefengzhuangyigezhichihuancundeqingqiufangfa.html-CKzu6UsP.js" as="script"><link rel="prefetch" href="/assets/tishengqianduankaifaxiaolvdeshijian.html-BqJWY_Hj.js" as="script"><link rel="prefetch" href="/assets/denglutaixuqian.html-C3SG3auK.js" as="script"><link rel="prefetch" href="/assets/cursorshiyongxinde.html-BV3cg_iX.js" as="script"><link rel="prefetch" href="/assets/shenruqianchuhuisusuanfa.html-BhbhFC5I.js" as="script"><link rel="prefetch" href="/assets/kuayudeyuanyinhejiejuefangan.html-CdpscKd9.js" as="script"><link rel="prefetch" href="/assets/fupeng2024nianHSBCyanjiangguandianshuli.html-Co76LafP.js" as="script"><link rel="prefetch" href="/assets/2024nianzhongzongjie.html-B8l9aJNS.js" as="script"><link rel="prefetch" href="/assets/2025nianzhongzongjie.html-DPSXzaN1.js" as="script"><link rel="prefetch" href="/assets/yirujiwang.html-D79tPN3-.js" as="script"><link rel="prefetch" href="/assets/qianduanchengxuyuanzhiyesikao.html-DemP9m0N.js" as="script"><link rel="prefetch" href="/assets/myself.html-56w-7P3E.js" as="script"><link rel="prefetch" href="/assets/404.html-B-Z0EDFR.js" as="script"><link rel="prefetch" href="/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/logo.png" alt="Ryan的个人网站"><a href="/" class="site-name can-hide">Ryan的个人网站</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="首页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->首页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/gongjulian/1.html" class="link" aria-label="分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分类<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/tags/gongjulian/1.html" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/timeline.html" class="link" aria-label="归档"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->归档<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="文档"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->文档<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="文档"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->文档<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/docs/introduce/myself" class="link" aria-label="关于我"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->关于我<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a class="link" href="https://github.com/au-to" target="_blank" rel="noopener noreferrer" aria-label="github"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->github<!--]--></span></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">深入浅出：Vue 与 React 的虚拟 DOM 和 Diff 算法全解析（含 Vue 3 优化）</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Ryan<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025/05/03<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/categories/qianduan/1.html" class="">前端</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/tags/kuangjiayuanli/1.html" class="">框架原理</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><p>在现代前端框架的浪潮中，Vue.js 和 React.js 无疑是两颗璀璨的明星。它们都以高效的性能和声明式的编程范式赢得了广大开发者的青睐。而在这背后，虚拟 DOM (Virtual DOM, VDOM) 和 Diff (Difference) 算法扮演着至关重要的角色。本文将带你由浅入深地探索它们的奥秘，并对比两者之间的差异，最后重点解析 Vue 3 在 Diff 算法上所做的革命性优化。</p><h2 id="一、什么是虚拟-dom-virtual-dom" tabindex="-1"><a class="header-anchor" href="#一、什么是虚拟-dom-virtual-dom"><span>一、什么是虚拟 DOM (Virtual DOM)？</span></a></h2><p>在理解 Diff 算法之前，我们首先需要明白什么是虚拟 DOM。</p><h3 id="_1-dom-的-昂贵-代价" tabindex="-1"><a class="header-anchor" href="#_1-dom-的-昂贵-代价"><span>1. DOM 的“昂贵”代价</span></a></h3><p>我们知道，Web 页面的内容、结构和样式都是通过文档对象模型 (Document Object Model, DOM) 来表示和操作的。当页面内容发生变化时，我们需要更新 DOM 以反映这些变化。然而，直接操作真实 DOM 的开销是相当大的：</p><ul><li><strong>性能瓶颈</strong>：频繁地、小范围地修改真实 DOM 会导致浏览器进行大量的重绘 (Repaint) 和回流 (Reflow)，这些操作非常消耗性能，可能导致页面卡顿。</li><li><strong>状态管理复杂</strong>：手动管理 DOM 更新逻辑复杂且容易出错，尤其是在大型应用中。</li></ul><h3 id="_2-虚拟-dom-的诞生" tabindex="-1"><a class="header-anchor" href="#_2-虚拟-dom-的诞生"><span>2. 虚拟 DOM 的诞生</span></a></h3><p>为了解决上述问题，虚拟 DOM 的概念应运而生。</p><ul><li><strong>定义</strong>：虚拟 DOM 本质上是一个<strong>JavaScript 对象</strong>，它是对真实 DOM 结构的一个轻量级、内存中的抽象表示。它描述了真实 DOM 应该是什么样子。</li><li><strong>工作流程</strong>： <ol><li>当应用状态发生改变时，框架会根据新的状态生成一个新的虚拟 DOM 树。</li><li>框架会将这个新的虚拟 DOM 树与上一次渲染时生成的旧虚拟 DOM 树进行比较（这就是 Diff 算法的用武之地）。</li><li>通过比较，找出两棵树之间的最小差异。</li><li>最后，框架会将这些差异高效地批量应用到真实 DOM 上，从而最大限度地减少直接操作真实 DOM 的次数和范围。</li></ol></li></ul><p>可以把虚拟 DOM 想象成建筑的<strong>设计蓝图</strong>。当需要修改建筑时，我们不是直接去砸墙拆瓦，而是先在蓝图上规划好修改方案，计算出最经济、影响最小的改动，然后再派施工队一次性精准施工。</p><h2 id="二、什么是-diff-算法" tabindex="-1"><a class="header-anchor" href="#二、什么是-diff-算法"><span>二、什么是 Diff 算法？</span></a></h2><p>Diff 算法是虚拟 DOM 技术的核心，它的主要任务是<strong>比较两个虚拟 DOM 树之间的差异</strong>，并找出一种最高效的方式来更新真实 DOM。</p><h3 id="_1-传统-diff-的挑战" tabindex="-1"><a class="header-anchor" href="#_1-传统-diff-的挑战"><span>1. 传统 Diff 的挑战</span></a></h3><p>完整地比较两棵任意树的差异，其算法复杂度通常是 $O(n^3)$，其中 $n$ 是树中节点的数量。对于复杂的前端应用来说，这个开销是无法接受的。</p><h3 id="_2-现代框架的启发式策略" tabindex="-1"><a class="header-anchor" href="#_2-现代框架的启发式策略"><span>2. 现代框架的启发式策略</span></a></h3><p>Vue 和 React 等现代框架的 Diff 算法都采用了一些<strong>启发式策略 (Heuristics)</strong>，将比较的复杂度优化到了 $O(n)$。这些策略基于一些实际开发中的常见情况：</p><ul><li><p><strong>策略一：只比较同层级的节点 (Tree Diffing)</strong>：</p><ul><li>框架会逐层比较新旧两棵虚拟 DOM 树。如果一个节点在某一层消失了，那么它及其所有子节点都会被完全移除。如果一个节点在某一层新增了，那么它及其所有子节点都会被全新创建。</li><li>这意味着跨层级的节点移动（比如将一个父节点的子节点移动到另一个父节点下）会被视为旧节点的删除和新节点的创建，而不是移动。虽然这可能不是理论上的最优解，但在实际应用中，跨层级移动节点的情况相对较少，这种简化大大提高了比较效率。</li></ul></li><li><p><strong>策略二：组件类型的比较 (Component Diffing)</strong>：</p><ul><li>如果两个节点代表的是不同类型的组件，那么 React/Vue 会直接销毁旧组件，创建并挂载新组件。它们不会尝试去复用或比较不同类型组件的内部结构。</li><li>如果两个节点代表的是相同类型的组件，框架会保留组件实例，仅更新其属性 (props)，并递归地对其子节点进行 Diff。</li></ul></li><li><p><strong>策略三：元素类型的比较 (Element Diffing)</strong>：</p><ul><li>如果两个节点代表的是相同类型的 HTML 元素 (如都是 <code>&lt;div&gt;</code> 或都是 <code>&lt;p&gt;</code>)，框架会保留该元素，并比较其属性 (attributes) 的差异，只更新发生变化的属性。</li><li>然后，框架会递归地处理该元素的子节点。</li></ul></li><li><p><strong>策略四：列表的 <code>key</code> 属性 (Keyed Fragments/Lists)</strong>：</p><ul><li>当处理一个节点列表（例如 <code>&lt;ul&gt;</code> 中的多个 <code>&lt;li&gt;</code>）时，如果没有提供 <code>key</code>，或者 <code>key</code> 值相同但顺序发生变化，框架可能需要进行大量的 DOM 移动或重建操作。</li><li>通过为列表中的每个子节点提供一个<strong>唯一的、稳定的 <code>key</code> 属性</strong>，Diff 算法可以更智能地识别节点的移动、删除和新增。例如，如果一个带 <code>key</code> 的节点从列表头部移动到了尾部，Diff 算法能够识别出这是一个“移动”操作，而不是“删除旧节点并在尾部创建新节点”，从而实现更高效的 DOM 更新，并能保持组件的内部状态（如输入框的内容）。</li></ul></li></ul><h2 id="三、react-的虚拟-dom-和-diff-算法" tabindex="-1"><a class="header-anchor" href="#三、react-的虚拟-dom-和-diff-算法"><span>三、React 的虚拟 DOM 和 Diff 算法</span></a></h2><h3 id="_1-vdom-表现形式" tabindex="-1"><a class="header-anchor" href="#_1-vdom-表现形式"><span>1. VDOM 表现形式</span></a></h3><p>在 React 中，虚拟 DOM 节点通常被称为 <strong>React Elements</strong>。它们是描述 UI 组件或 HTML 标签的普通 JavaScript 对象。<code>JSX</code> 最终会被编译成 <code>React.createElement()</code> 调用，这些调用返回的就是 React Elements。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// JSX</span></span>
<span class="line"><span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">&quot;greeting&quot;</span><span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> world<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 等价的 React.createElement() 调用</span></span>
<span class="line"><span class="token keyword">const</span> element <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span><span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">&#39;greeting&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&#39;Hello, world&#39;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// element 对象的结构（简化版）</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">&#39;greeting&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;Hello, world&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// ...其他属性如 key, ref</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-diff-策略特点" tabindex="-1"><a class="header-anchor" href="#_2-diff-策略特点"><span>2. Diff 策略特点</span></a></h3><p>React 的 Diff 算法遵循上述提到的启发式策略：</p><ul><li><strong>Tree Diffing</strong>：逐层比较。</li><li><strong>Component Diffing</strong>： <ul><li>不同类型的组件：销毁旧的，创建新的。</li><li>相同类型的组件：更新 props，递归 diff 子节点。开发者可以通过 <code>shouldComponentUpdate</code> (类组件) 或 <code>React.memo</code> (函数组件配合 <code>areEqual</code> 函数) 来手动控制组件是否需要重新渲染，从而进行性能优化。</li></ul></li><li><strong>Element Diffing</strong>： <ul><li>相同类型的 HTML 元素：保留 DOM 节点，仅更新变化的属性。</li><li>不同类型的 HTML 元素：移除旧的，创建新的。</li></ul></li><li><strong>Keys for Lists</strong>：当比较一组子节点时，React 会同时遍历新旧两组子节点。 <ul><li><strong>无 <code>key</code> 或 <code>key</code> 不足以区分</strong>：它会按顺序进行比较，如果发现不一致，则销毁后续所有旧节点，并创建所有新节点。这在列表项顺序改变或中间插入/删除项时效率较低。</li><li><strong>有 <code>key</code></strong>：React 使用 <code>key</code> 来匹配新旧列表中的元素。 <ol><li>首先，它会尝试匹配 <code>key</code> 相同的节点。</li><li>对于未匹配上的新 <code>key</code>，创建新节点。</li><li>对于未匹配上的旧 <code>key</code>，删除旧节点。</li><li>对于 <code>key</code> 相同但位置可能改变的节点，进行移动操作。</li></ol></li></ul></li></ul><p>React 的 Diff 过程可以概括为：当组件状态或 props 改变时，<code>render</code> 方法会返回一个新的 React Element 树。React 会将这棵新树与旧树进行比较，计算出需要对真实 DOM 进行的最小更新。</p><h2 id="四、vue-的虚拟-dom-和-diff-算法" tabindex="-1"><a class="header-anchor" href="#四、vue-的虚拟-dom-和-diff-算法"><span>四、Vue 的虚拟 DOM 和 Diff 算法</span></a></h2><p>Vue 的虚拟 DOM 和 Diff 算法在核心思想上与 React 类似，但也存在一些重要的差异和优化，尤其是在 Vue 3 中。</p><h3 id="_1-vdom-表现形式-1" tabindex="-1"><a class="header-anchor" href="#_1-vdom-表现形式-1"><span>1. VDOM 表现形式</span></a></h3><p>在 Vue 中，虚拟 DOM 节点被称为 <strong>VNode</strong>。模板 (template) 会被 Vue 的编译器编译成渲染函数 (render function)，而渲染函数执行后会返回一个 VNode 树。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// Template</span></span>
<span class="line"><span class="token comment">// &lt;div id=&quot;app&quot; :class=&quot;myClass&quot;&gt;Hello {{ name }}&lt;/div&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 渲染函数（简化示意）</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;app&#39;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>myClass <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&#39;Hello &#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token comment">// 文本节点也会是 VNode</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// VNode 结构（简化版）</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 标签名</span></span>
<span class="line">  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 属性、事件等</span></span>
<span class="line">    <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;app&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&#39;some-class&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 子 VNode</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;Hello &#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;Vue&#39;</span> <span class="token punctuation">}</span> <span class="token comment">// 假设 this.name 是 &#39;Vue&#39;</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// ...其他属性如 key, elm (对应的真实 DOM 元素)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-vue-2-的-diff-策略特点" tabindex="-1"><a class="header-anchor" href="#_2-vue-2-的-diff-策略特点"><span>2. Vue 2 的 Diff 策略特点</span></a></h3><p>Vue 2 的 Diff 算法同样基于上述启发式策略，但在列表 Diff (子节点 Diff) 方面有一个著名的优化：<strong>双端比较 (Double-ended Comparison / Two-ended Diffing)</strong>。</p><p>当比较一个列表的新旧 VNode 子节点时 (比如 <code>v-for</code> 生成的列表)，Vue 2 的 Diff 算法会同时维护四个指针：</p><ul><li><code>oldStartIndex</code>：指向旧 VNode 列表的开始位置</li><li><code>oldEndIndex</code>：指向旧 VNode 列表的结束位置</li><li><code>newStartIndex</code>：指向新 VNode 列表的开始位置</li><li><code>newEndIndex</code>：指向新 VNode 列表的结束位置</li></ul><p>它会进行多轮比较，尝试以最高效的方式匹配节点：</p><ol><li><strong>旧首 vs 新首</strong> (<code>oldStartVnode</code> vs <code>newStartVnode</code>)：如果相同，则 patch 它们，两个指针都后移。</li><li><strong>旧尾 vs 新尾</strong> (<code>oldEndVnode</code> vs <code>newEndVnode</code>)：如果相同，则 patch 它们，两个指针都前移。</li><li><strong>旧首 vs 新尾</strong> (<code>oldStartVnode</code> vs <code>newEndVnode</code>)：如果相同，则 patch 它们，并将旧首对应的真实 DOM 节点移动到旧尾之后，旧首指针后移，新尾指针前移。</li><li><strong>旧尾 vs 新首</strong> (<code>oldEndVnode</code> vs <code>newStartVnode</code>)：如果相同，则 patch 它们，并将旧尾对应的真实 DOM 节点移动到旧首之前，旧尾指针前移，新首指针后移。</li></ol><p>如果以上四种比较都不匹配：</p><ul><li>会尝试使用 <code>key</code> 来查找匹配。如果新首节点 (<code>newStartVnode</code>) 的 <code>key</code> 在旧列表中存在，则进行 patch 和移动。</li><li>如果找不到 <code>key</code> (或者节点没有 <code>key</code>)，则将 <code>newStartVnode</code> 视为新节点并创建。</li></ul><p>这个双端比较策略能够有效地处理列表两端的变化、列表反转等情况，比 React 单纯从头到尾的比较在某些场景下更优。</p><h2 id="五、vue-与-react-diff-算法的主要差异总结" tabindex="-1"><a class="header-anchor" href="#五、vue-与-react-diff-算法的主要差异总结"><span>五、Vue 与 React Diff 算法的主要差异总结</span></a></h2><ol><li><p><strong>编译优化程度</strong>：</p><ul><li><strong>Vue</strong>：Vue 的模板在编译阶段可以进行更多的静态分析。编译器可以标记出哪些部分是静态的（永远不会改变），哪些部分是动态的。这为后续的 Diff 过程提供了重要信息，允许 Vue 跳过对静态内容的 Diff。Vue 3 在这方面做得更为极致。</li><li><strong>React</strong>：React 主要依赖 JSX，其灵活性更高，但编译时能做的静态分析相对较少。优化通常依赖开发者手动使用 <code>React.memo</code>、<code>useCallback</code>、<code>useMemo</code> 和 <code>shouldComponentUpdate</code>。</li></ul></li><li><p><strong>列表 Diff 策略 (Vue 2 vs React)</strong>：</p><ul><li><strong>Vue 2</strong>：采用双端比较算法，对列表的头尾移动、反转等场景有较好的优化。</li><li><strong>React</strong>：主要从头开始匹配，依赖 <code>key</code> 进行高效的节点复用和移动。</li></ul></li><li><p><strong>更新粒度与响应式系统</strong>：</p><ul><li><strong>Vue</strong>：Vue 的响应式系统能够精确追踪到是哪个数据发生了变化。当数据变化时，它能够“通知”依赖该数据的组件或 VNode 进行更新。这使得 Vue 在某些情况下可以做到更细粒度的更新，甚至可能跳过整个 Diff 过程，直接更新某个动态绑定。</li><li><strong>React</strong>：React 的更新通常是从根组件或调用了 <code>setState</code>/<code>useState</code> 的组件开始，自顶向下进行 Diff。虽然 React 也有一些优化（如 Fiber 架构可以中断和恢复渲染），但其“拉”数据的特性决定了它需要 Diff 子树来确定变化。</li></ul></li></ol><h2 id="六、vue-3-diff-算法的革命性优化" tabindex="-1"><a class="header-anchor" href="#六、vue-3-diff-算法的革命性优化"><span>六、Vue 3 Diff 算法的革命性优化</span></a></h2><p>Vue 3 在 Diff 算法方面引入了多项重要的优化，这些优化主要得益于其编译器在编译模板时收集到的更多信息。其核心目标是<strong>最大限度地减少运行时 Diff 的工作量</strong>。</p><h3 id="_1-静态树提升-static-tree-hoisting" tabindex="-1"><a class="header-anchor" href="#_1-静态树提升-static-tree-hoisting"><span>1. 静态树提升 (Static Tree Hoisting)</span></a></h3><ul><li><strong>概念</strong>：对于模板中完全静态的部分（即不包含任何动态绑定、没有 <code>v-if</code>/<code>v-for</code> 等指令的纯 HTML 结构和内容），Vue 3 编译器会将其“提升”出 <code>render</code> 函数。这意味着这些静态内容的 VNode 在组件初始化时只创建一次，后续的重新渲染会直接复用这些静态 VNode，完全跳过对它们的 Diff。</li><li><strong>好处</strong>：减少了 VNode 创建的开销，并显著减少了 Diff 的范围。</li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html" data-title="html"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>我是静态标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>我也是静态段落<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ dynamicContent }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-patch-flags-补丁标记" tabindex="-1"><a class="header-anchor" href="#_2-patch-flags-补丁标记"><span>2. Patch Flags (补丁标记)</span></a></h3><p>这是 Vue 3 Diff 算法中最具创新性的优化之一。</p><ul><li><p><strong>概念</strong>：在编译阶段，Vue 3 的编译器会分析模板中的动态绑定。对于动态节点 (包含动态属性、动态文本内容等的 VNode)，编译器会根据其可能发生变化的类型给它打上一个或多个“补丁标记 (Patch Flag)”。这个标记是一个数字，表示该节点需要进行哪些类型的更新检查。</p></li><li><p><strong>示例 Patch Flags</strong>：</p><ul><li><code>TEXT = 1</code>：表示该节点只有文本内容是动态的。Diff 时只需比较文本内容。</li><li><code>CLASS = 1 &lt;&lt; 1</code> (二进制 <code>10</code>): 表示只有 <code>class</code> 绑定是动态的。</li><li><code>STYLE = 1 &lt;&lt; 2</code> (二进制 <code>100</code>): 表示只有 <code>style</code> 绑定是动态的。</li><li><code>PROPS = 1 &lt;&lt; 3</code> (二进制 <code>1000</code>): 表示有非 <code>class</code>/<code>style</code> 的动态属性。</li><li><code>FULL_PROPS = 1 &lt;&lt; 4</code>: 表示有动态 <code>key</code>，或者 <code>props</code> 的数量可能改变，需要完整的 <code>props</code> Diff。</li><li><code>HYDRATE_EVENTS = 1 &lt;&lt; 5</code>: 节点带有仅在 hydration 阶段需要处理的事件监听器。</li><li><code>NEED_PATCH = 1 &lt;&lt; 9</code>: 表示该节点是一个带有 <code>ref</code> 或者 <code>v-on</code> 指令的组件，需要进行 patch。</li><li><code>KEYED_FRAGMENT = 1 &lt;&lt; 7</code>, <code>UNKEYED_FRAGMENT = 1 &lt;&lt; 8</code>: 表示片段的子节点是否有 key。</li><li><code>HOISTED = -1</code>: 表示这是一个静态提升的节点，不需要 patch。</li><li><code>BAIL = -2</code>: 表示一个 diff过程应该退出优化模式。</li></ul></li><li><p><strong>工作方式</strong>：在运行时进行 Diff 时，Vue 3 会检查 VNode 上的 <code>patchFlag</code>。</p><ul><li>如果一个节点没有 <code>patchFlag</code> 或者 <code>patchFlag</code> 为 <code>HOISTED</code>，则跳过它的 Diff。</li><li>如果节点有 <code>patchFlag</code>，例如 <code>TEXT</code>，那么 Diff 算法就只比较新旧 VNode 的文本内容，而完全忽略其属性、子节点等的比较。如果 <code>patchFlag</code> 是 <code>CLASS</code>，就只比较 <code>class</code>。</li></ul></li><li><p><strong>好处</strong>：极大地缩小了 Diff 的范围。不再需要对整个 VNode 的所有属性和子节点进行完整比较，而是“按需 Diff”，只 Diff 真正可能变化的部分。</p></li></ul><h3 id="_3-block-tree-块级树-与动态节点追踪" tabindex="-1"><a class="header-anchor" href="#_3-block-tree-块级树-与动态节点追踪"><span>3. Block Tree (块级树) 与动态节点追踪</span></a></h3><ul><li><strong>概念</strong>：Vue 3 编译器会将模板分割成“块 (Block)”。一个块通常是包含动态内容的 VNode 节点，或者是一个带有 <code>v-if</code> / <code>v-for</code> 指令的节点。在每个块内部，编译器会收集所有动态的后代节点（即那些带有 <code>patchFlag</code> 的节点），并将它们存储在一个扁平化的数组中。</li><li><strong>工作方式</strong>：当一个组件更新时，Vue 3 不再需要递归地遍历整个 VNode 树。它只需要遍历这个组件内所有 Block 中的动态节点列表。由于这些动态节点已经被预先收集并标记了 <code>patchFlag</code>，Diff 过程变得非常高效。</li><li><strong>好处</strong>： <ul><li><strong>更新性能与模板大小解耦</strong>：组件的更新性能不再与模板的整体大小成正比，而是与模板中动态内容的数量成正比。即使模板非常庞大，只要动态内容少，更新依然很快。</li><li><strong>跳过静态结构</strong>：整个静态的树结构分支在 Diff 过程中被完全忽略。</li></ul></li></ul><h3 id="_4-缓存事件处理函数-cache-handlers" tabindex="-1"><a class="header-anchor" href="#_4-缓存事件处理函数-cache-handlers"><span>4. 缓存事件处理函数 (Cache Handlers)</span></a></h3><ul><li><strong>概念</strong>：在 Vue 2 中，如果模板中使用了内联的事件处理函数（例如 <code>@click=&quot;() =&gt; count++&quot;</code>），每次父组件重新渲染时，即使事件处理函数的逻辑没有改变，也会生成一个新的函数实例。这会导致子组件因为接收到新的 <code>props</code> (事件处理函数也是 <code>props</code>) 而不必要地重新渲染。</li><li><strong>Vue 3 优化</strong>：编译器可以检测到这种情况，并将内联的事件处理函数缓存起来。除非依赖的数据发生变化，否则会复用相同的函数实例。</li><li><strong>好处</strong>：减少了不必要的子组件更新，提高了性能。</li></ul><h3 id="vue-3-diff-总结" tabindex="-1"><a class="header-anchor" href="#vue-3-diff-总结"><span>Vue 3 Diff 总结</span></a></h3><p>Vue 3 通过编译时的深度优化（静态提升、补丁标记、块级树），将大量 Diff 工作提前到编译阶段完成，使得运行时的 Diff 算法变得极其轻量和高效。它不再是 Vue 2 那样的“完整 Diff”配合一些启发式策略，而是变成了一种“靶向精确打击”的更新模式。对于列表的 Diff，Vue 3 仍然使用了类似 Vue 2 双端比较的思想，但结合了 <code>patchFlag</code>，可以更快速地处理。例如，如果一个列表中的所有子项都是静态的，只是顺序可能变化（通过 <code>key</code>），那么 Diff 就会非常快。</p><h2 id="七、我们何时需要-关心-diff-算法" tabindex="-1"><a class="header-anchor" href="#七、我们何时需要-关心-diff-算法"><span>七、我们何时需要“关心”Diff 算法？</span></a></h2><p>对于大部分日常开发而言，我们其实<strong>不太需要直接关心 Diff 算法的内部细节</strong>。Vue 和 React 已经为我们处理了绝大部分的性能优化工作。我们更应该关注的是：</p><ol><li><strong>正确使用 <code>key</code></strong>：在渲染列表时，务必为每个列表项提供唯一的、稳定的 <code>key</code>。这是保证列表更新性能和状态保持的关键。</li><li><strong>避免不必要的组件渲染</strong>： <ul><li>在 React 中，合理使用 <code>React.memo</code>、<code>useCallback</code>、<code>useMemo</code>，以及在类组件中使用 <code>shouldComponentUpdate</code>。</li><li>在 Vue 中，虽然其响应式系统和编译优化已经做得很好，但仍然要注意 props 的稳定性，避免不必要的深度侦听等。</li></ul></li><li><strong>理解组件的生命周期和更新机制</strong>：知道什么时候组件会更新，有助于写出更高效的代码。</li><li><strong>合理组织组件结构</strong>：将大的组件拆分成更小的、职责单一的组件，有助于隔离变化，减少更新范围。</li></ol><h2 id="八、总结" tabindex="-1"><a class="header-anchor" href="#八、总结"><span>八、总结</span></a></h2><p>虚拟 DOM 和 Diff 算法是现代前端框架实现高性能UI更新的核心技术。它们通过在 JavaScript 层面模拟 DOM 结构，并通过高效的比较算法找出最小的变更集，从而减少了对昂贵的真实 DOM 操作。</p><ul><li><strong>React</strong> 采用了一套行之有效的启发式 Diff 策略，并通过 JSX 提供了灵活的开发体验。其性能优化更多依赖于运行时的机制和开发者的手动优化。</li><li><strong>Vue</strong> 在 Diff 策略上与 React 有相似之处，Vue 2 的双端比较在列表 Diff 上有其特色。而 <strong>Vue 3</strong> 则通过强大的编译器，在编译阶段就对模板进行了深度分析和优化，引入了静态树提升、补丁标记和块级树等概念，使得运行时的 Diff 效率达到了新的高度，实现了更新性能与模板大小的解耦。</li></ul><p>理解这些底层原理，不仅能帮助我们写出更高性能的代码，也能让我们在遇到复杂问题时有更清晰的排查思路。希望本文能为你揭开 Vue 和 React 中虚拟 DOM 与 Diff 算法的神秘面纱！</p></div></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->最后更新时间 6/14/2025, 6:04:25 AM<!--]--></span></span></div></footer><!----><div class="reco-giscus-wrapper"><!----></div></div><div class="page-catalog-container"><h5 class="tip">目录</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#一、什么是虚拟-dom-virtual-dom" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="一、什么是虚拟 DOM (Virtual DOM)？"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->一、什么是虚拟 DOM (Virtual DOM)？<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_1-dom-的-昂贵-代价" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. DOM 的“昂贵”代价"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. DOM 的“昂贵”代价<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_2-虚拟-dom-的诞生" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. 虚拟 DOM 的诞生"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. 虚拟 DOM 的诞生<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#二、什么是-diff-算法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="二、什么是 Diff 算法？"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->二、什么是 Diff 算法？<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_1-传统-diff-的挑战" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. 传统 Diff 的挑战"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. 传统 Diff 的挑战<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_2-现代框架的启发式策略" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. 现代框架的启发式策略"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. 现代框架的启发式策略<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#三、react-的虚拟-dom-和-diff-算法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="三、React 的虚拟 DOM 和 Diff 算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->三、React 的虚拟 DOM 和 Diff 算法<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_1-vdom-表现形式" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. VDOM 表现形式"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. VDOM 表现形式<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_2-diff-策略特点" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. Diff 策略特点"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. Diff 策略特点<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#四、vue-的虚拟-dom-和-diff-算法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="四、Vue 的虚拟 DOM 和 Diff 算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->四、Vue 的虚拟 DOM 和 Diff 算法<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_1-vdom-表现形式-1" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. VDOM 表现形式"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. VDOM 表现形式<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_2-vue-2-的-diff-策略特点" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. Vue 2 的 Diff 策略特点"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. Vue 2 的 Diff 策略特点<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#五、vue-与-react-diff-算法的主要差异总结" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="五、Vue 与 React Diff 算法的主要差异总结"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->五、Vue 与 React Diff 算法的主要差异总结<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#六、vue-3-diff-算法的革命性优化" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="六、Vue 3 Diff 算法的革命性优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->六、Vue 3 Diff 算法的革命性优化<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_1-静态树提升-static-tree-hoisting" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. 静态树提升 (Static Tree Hoisting)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. 静态树提升 (Static Tree Hoisting)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_2-patch-flags-补丁标记" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. Patch Flags (补丁标记)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. Patch Flags (补丁标记)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_3-block-tree-块级树-与动态节点追踪" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3. Block Tree (块级树) 与动态节点追踪"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3. Block Tree (块级树) 与动态节点追踪<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#_4-缓存事件处理函数-cache-handlers" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4. 缓存事件处理函数 (Cache Handlers)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4. 缓存事件处理函数 (Cache Handlers)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#vue-3-diff-总结" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Vue 3 Diff 总结"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Vue 3 Diff 总结<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#七、我们何时需要-关心-diff-算法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="七、我们何时需要“关心”Diff 算法？"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->七、我们何时需要“关心”Diff 算法？<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/qianduan/xunidomhediffsuanfaxiangjie.html#八、总结" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="八、总结"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->八、总结<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-_qvWuZqY.js" defer></script>
  </body>
</html>
